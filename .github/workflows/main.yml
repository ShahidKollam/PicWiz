# .github/workflows/main.yml

# The name of your CI/CD pipeline
name: Image Upload Service CI

# This workflow will run on every push to the 'main' branch
on:
  push:
    branches:
      - main

# Define the jobs to run in the workflow
jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Check out your repository code
    - name: Checkout repository
      uses: actions/checkout@v2

    # Step 2: Install Docker Compose and run the test environment
    - name: Install Docker Compose
      run: |
        sudo apt-get update
        sudo apt-get install -y docker-compose

    - name: Run Integration Tests
      run: docker-compose -f docker-compose.test.yml up --build --exit-code-from test-runner

    # Step 3: Clean up Docker containers
    - name: Clean up Docker containers
      if: always()
      run: docker-compose -f docker-compose.test.yml down